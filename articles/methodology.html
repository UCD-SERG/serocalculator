<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Methodology ‚Ä¢ serocalculator</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="methodology_files/libs/quarto-html/popper.min.js"></script><script src="methodology_files/libs/quarto-html/tippy.umd.min.js"></script><link href="methodology_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="methodology_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Methodology">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">serocalculator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0.9022</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/serocalculator.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/enteric_fever_example.html">Enteric Fever Seroincidence Vignette</a></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/scrubTyphus_example.html">Scrub Typhus Seroincidence Vignette</a></li>
    <li><a class="dropdown-item" href="../articles/simulate_xsectionalData.html">Generate a simulated cross-sectional sample and estimate seroincidence</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UCD-SERG/serocalculator/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Methodology</h1>




      <small class="dont-index">Source: <a href="https://github.com/UCD-SERG/serocalculator/blob/main/vignettes/methodology.qmd" class="external-link"><code>vignettes/methodology.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<section class="level2"><h3 id="defining-incidence">Defining incidence<a class="anchor" aria-label="anchor" href="#defining-incidence"></a>
</h3>
<p>The <strong>incidence rate</strong> of a disease over a <strong>specific time period</strong> is the rate at which individuals in a population are <em>acquiring</em> the disease during that time period <span class="citation" data-cites="Noordzij2010diseasemeasures">[@Noordzij2010diseasemeasures]</span>.</p>
<p><strong>Example:</strong> if there are <strong>10 new cases</strong> of typhoid in a population of <strong>1000 persons</strong> during a <strong>one month</strong> time period, then the incidence rate for that time period is <strong>10 new cases per 1000 persons per month</strong>.</p>
</section><section class="level2" data-visibility="hidden"><h3 data-visibility="hidden" id="mathematical-definition-of-incidence">Mathematical definition of incidence<a class="anchor" aria-label="anchor" href="#mathematical-definition-of-incidence"></a>
</h3>
<p>More mathematically, the incidence rate <em>at a given time point</em> is the <em>derivative</em> (i.e., the current rate of change over time) of the expected cumulative count of infections per person at risk, at that time:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>d</mi><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mfrac><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>n</mi></mfrac><mo>‚à£</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>n</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\frac{d}{dt} \mathbb{E}\left[\frac{C(t)}{n} \mid N(t) =n\right]</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">C(t)</annotation></semantics></math> is the cumulative total number of infections in the population of interest, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(t)</annotation></semantics></math> is the number of individuals at risk at time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
</section><section class="level2" data-visibility="hidden"><h3 data-visibility="hidden" id="scale-of-incidence-rates">Scale of incidence rates<a class="anchor" aria-label="anchor" href="#scale-of-incidence-rates"></a>
</h3>
<p>In both definitions, the units for an incidence rate are ‚Äú# new infections per # persons at risk per time duration‚Äù; for example, ‚Äúnew infections per 1000 persons per year‚Äù.</p>
<p>For convenience, we can rescale the incidence rate to make it easier to understand; for example, we might express incidence as ‚Äú# new infections per 1000 persons per year‚Äù or ‚Äú# new infections per 100,000 persons per day‚Äù, etc.</p>
</section><section class="level2"><h3 id="incidence-from-an-individuals-perspective">Incidence from an individual‚Äôs perspective<a class="anchor" aria-label="anchor" href="#incidence-from-an-individuals-perspective"></a>
</h3>
<p>From the perspective of an individual in the population:</p>
<ul>
<li><p>the <strong>incidence rate</strong> (at a given time point (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>) is the instantaneous <strong>probability</strong> (density) of <strong>becoming infected</strong> at that time point, <strong>given</strong> that they are <strong>at risk</strong> at that time point.</p></li>
<li><p>That is, the incidence rate is a <strong>hazard</strong> rate.</p></li>
<li><p>Notation: let‚Äôs use <strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œª</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\lambda_{t}</annotation></semantics></math></strong> to denote the incidence rate at time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p></li>
</ul></section></section><section class="section level2"><h2 id="estimating-incidence-from-cross-sectional-antibody-surveys">Estimating incidence from cross-sectional antibody surveys<a class="anchor" aria-label="anchor" href="#estimating-incidence-from-cross-sectional-antibody-surveys"></a>
</h2>
<section class="level2 incremental"><h3 class="incremental" id="cross-sectional-antibody-surveys">Cross-sectional antibody surveys<a class="anchor" aria-label="anchor" href="#cross-sectional-antibody-surveys"></a>
</h3>
<div class="notes">
<p>Typically, it is difficult to estimate changes from a single time point. However, we can sometimes make assumptions that allow us to do so. In particular, if we assume that the incidence rate is constant over time, then we can estimate incidence from a single cross-sectional survey.</p>
<p>We will need two pieces of notation to formalize this process.</p>
</div>
<div class="incremental">
<ul class="incremental">
<li><p>We recruit participants from the population of interest.</p></li>
<li><p>For each survey participant, we measure antibody levels <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(Y)</annotation></semantics></math> for the disease of interest</p></li>
<li><p>Each participant was <strong>most recently infected</strong> at some time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(T)</annotation></semantics></math><strong>prior</strong> to when we measured their antibodies.</p></li>
</ul>
<div class="notes">
<ul>
<li>If a participant has never been infected since birth, then <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math> is undefined.</li>
</ul>
</div>
<ul class="incremental">
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math> is a <strong>latent, unobserved variable</strong>.</li>
</ul>
<div class="notes">
<ul>
<li>We <strong>don‚Äôt directly observe <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math></strong>; we <strong>only observe <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math></strong>, which we hope tells us something about <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>.</li>
</ul>
</div>
</div>
</section><section class="level2"><h3 id="modeling-assumptions">Modeling assumptions<a class="anchor" aria-label="anchor" href="#modeling-assumptions"></a>
</h3>
<p>We <strong>assume</strong> that:</p>
<div class="incremental">
<ul class="incremental">
<li>The incidence rate is approximately <strong>constant</strong> <strong>over time</strong> and <strong>across the population</strong> (‚Äú<strong>constant and homogenous incidence</strong>‚Äù)</li>
</ul>
<div class="notes">
<ul>
<li>that is: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œª</mi><mrow><mi>i</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>=</mo><mi>Œª</mi><mo>,</mo><mo>‚àÄ</mo><mi>i</mi><mo>,</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">\lambda_{i,t} = \lambda, \forall i,t</annotation></semantics></math>
</li>
</ul>
<p>(We can analyze subpopulations separately to make homogeneity more plausible.)</p>
</div>
<ul class="incremental">
<li>Participants are always at risk of a new infection, regardless of how recently they have been infected (‚Äú<strong>no lasting immunity</strong>‚Äù).</li>
</ul>
</div>
<div class="notes">
<p>(For diseases like typhoid, the no-immunity assumption may not hold exactly, but hopefully approximately; modeling the effects of re-exposure during an active infection is <a href="https://github.com/UCD-SERG/dcm/issues/11" class="external-link">on our to-do list</a>).</p>
</div>
</section><section class="level2"><h3 id="time-since-infection-and-incidence">Time since infection and incidence<a class="anchor" aria-label="anchor" href="#time-since-infection-and-incidence"></a>
</h3>
<p>Under those assumptions:</p>
<div class="incremental">
<ul class="incremental">
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math> has an <strong>exponential distribution</strong>:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Œª</mi><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>‚àí</mi><mi>Œª</mi><mi>t</mi><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{p}(T=t) = \lambda \exp{\left\{-\lambda t\right\}}</annotation></semantics></math></p>
<ul class="incremental">
<li>More precisely, the distribution is exponential <strong>truncated by age</strong> at observation (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>):</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mi>A</mi><mo>=</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mn>1</mn><mrow><mi>t</mi><mo>‚àà</mo><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mi>Œª</mi><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>‚àí</mi><mi>Œª</mi><mi>t</mi><mo stretchy="true" form="postfix">}</mo></mrow><mo>+</mo><msub><mn>1</mn><mrow><mi>t</mi><mo>=</mo><mtext mathvariant="normal">NA</mtext></mrow></msub><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>‚àí</mi><mi>Œª</mi><mi>a</mi><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{p}(T=t|A=a) = 1_{t \in[0,a]}\lambda \exp{\left\{-\lambda t\right\}} + 1_{t = \text{NA}} \exp{\left\{-\lambda a\right\}}</annotation></semantics></math></p>
<ul class="incremental">
<li>the rate parameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> is the incidence rate</li>
</ul>
</div>
<div class="notes">
<p>This is a time-to-event model, looking <strong>backwards in time</strong> from the survey date (when the blood sample was collected).</p>
<p>The probability that an individual was <strong>last</strong> infected <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math> days ago, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(T=t)</annotation></semantics></math>, is equal to the probability of being infected at time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math> (i.e., the incidence rate at time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>) times the probability of not being infected after time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>, which turns out to be <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>‚àí</mi><mi>Œª</mi><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(-\lambda t)</annotation></semantics></math>.</p>
<p>The distribution of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math> is truncated by the patient‚Äôs birth date; the probability that they have never been infected is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>‚àí</mi><mi>Œª</mi><mi>a</mi><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">\exp{\left\{-\lambda a\right\}}</annotation></semantics></math>, where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math> is the patient‚Äôs age at the time of the survey.</p>
</div>
</section><section class="level2 smaller"><h3 class="smaller" id="likelihood-of-latent-infection-times">Likelihood of latent infection times<a class="anchor" aria-label="anchor" href="#likelihood-of-latent-infection-times"></a>
</h3>
<div class="notes">
<p>If we could observe <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>, then we could estimate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> using a typical maximum likelihood approach.</p>
</div>
<div class="notes">
<p>Starting with the likelihood: Taking the logarithm of the likelihood: Taking the derivative of that log-likelihood to find the score function: Setting the score function equal to 0 to find the score equation, and solving the score equation for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> to find the maximum likelihood estimate:</p>
</div>
<div class="incremental">
<ul class="incremental">
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>‚Ñí</mi><mo>*</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>‚àè</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>‚àè</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>Œª</mi><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>‚àí</mi><mi>Œª</mi><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^*(\lambda) = \prod_{i=1}^n \mathbb{p}(T=t_i) = \prod_{i=1}^n \lambda \exp(-\lambda t_i)</annotation></semantics></math></p></li>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>‚Ñì</mo><mo>*</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">{</mo><msup><mi>‚Ñí</mi><mo>*</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo>log</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>Œª</mi><mo stretchy="true" form="postfix">}</mo></mrow><mo>‚àí</mo><mi>Œª</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\ell^*(\lambda) = \log{\left\{\mathcal{L}^*(\lambda)\right\}} = \sum_{i=1}^n \log{\left\{\lambda\right\}} -\lambda t_i</annotation></semantics></math></p></li>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>‚Ñì</mo><mrow><mi>*</mi><mi>‚Ä≤</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mi>Œª</mi><mrow><mi>‚àí</mi><mn>1</mn></mrow></msup><mo>‚àí</mo><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\ell^{*'}(\lambda) = \sum_{i=1}^n \lambda^{-1} - t_i</annotation></semantics></math></p></li>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Œª</mi><mo accent="true">ÃÇ</mo></mover><mtext mathvariant="normal">ML</mtext></msub><mo>=</mo><mfrac><mi>n</mi><mrow><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>t</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mover><mi>t</mi><mo accent="true">‚Äæ</mo></mover></mfrac></mrow><annotation encoding="application/x-tex">\hat{\lambda}_{\text{ML}} = \frac{n}{\sum_{i=1}^n t_i} = \frac{1}{\bar{t}}</annotation></semantics></math></p></li>
</ul>
</div>
<div class="notes">
<p>The MLE turns out to be the inverse of the mean.</p>
</div>
</section><section class="level2"><h3 id="example-log-likelihood-curves">Example log-likelihood curves<a class="anchor" aria-label="anchor" href="#example-log-likelihood-curves"></a>
</h3>
<div class="notes">
<p>Here‚Äôs what that would look like:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/UCD-SERG/serocalculator" class="external-link">serocalculator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import longitudinal antibody parameters from OSF</span></span>
<span><span class="va">curves</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://osf.io/download/rtw5k/"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/load_curve_params.html">load_curve_params</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iter</span> <span class="op">&lt;</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import cross-sectional data from OSF and rename required variables:</span></span>
<span><span class="va">xs_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://osf.io/download//n6cp3/"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/load_pop_data.html">load_pop_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://osf.io/download//hqy4v/"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lik_HlyE_IgA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_loglik.html">graph_loglik</a></span><span class="op">(</span></span>
<span>  pop_data <span class="op">=</span> <span class="va">xs_data</span>,</span>
<span>  curve_params <span class="op">=</span> <span class="va">curves</span>,</span>
<span>  noise_params <span class="op">=</span> <span class="va">noise</span>,</span>
<span>  antigen_isos <span class="op">=</span> <span class="st">"HlyE_IgA"</span>,</span>
<span>  log_x <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">lik_HlyE_IgG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_loglik.html">graph_loglik</a></span><span class="op">(</span></span>
<span>  previous_plot <span class="op">=</span> <span class="va">lik_HlyE_IgA</span>,</span>
<span>  pop_data <span class="op">=</span> <span class="va">xs_data</span>,</span>
<span>  curve_params <span class="op">=</span> <span class="va">curves</span>,</span>
<span>  noise_params <span class="op">=</span> <span class="va">noise</span>,</span>
<span>  antigen_isos <span class="op">=</span> <span class="st">"HlyE_IgG"</span>,</span>
<span>  log_x <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">lik_both</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_loglik.html">graph_loglik</a></span><span class="op">(</span></span>
<span>  previous_plot <span class="op">=</span> <span class="va">lik_HlyE_IgG</span>,</span>
<span>  pop_data <span class="op">=</span> <span class="va">xs_data</span>,</span>
<span>  curve_params <span class="op">=</span> <span class="va">curves</span>,</span>
<span>  noise_params <span class="op">=</span> <span class="va">noise</span>,</span>
<span>  antigen_isos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HlyE_IgG"</span>, <span class="st">"HlyE_IgA"</span><span class="op">)</span>,</span>
<span>  log_x <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lik_both</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-loglik" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-loglik-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methodology_files/figure-html/fig-loglik-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-loglik-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure¬†1: Example log(likelihood) curves
</figcaption></figure>
</div>
</div>
</div>
</section><section class="level2"><h3 id="standard-error">standard error<a class="anchor" aria-label="anchor" href="#standard-error"></a>
</h3>
<p>The standard error of the estimate is approximately equal to the inverse of the rate of curvature (2nd derivative, aka Hessian) in the log-likelihood function, at the maximum:</p>
<p>more curvature -&gt; likelihood peak is clearer -&gt; smaller standard errors</p>
</section><section class="level2"><h3 id="likelihood-of-observed-data">Likelihood of observed data<a class="anchor" aria-label="anchor" href="#likelihood-of-observed-data"></a>
</h3>
<div class="notes">
<p>Unfortunately, we don‚Äôt observe infection times <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>; we only observe antibody levels <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">{Y}</annotation></semantics></math>. So things get a little more complicated.</p>
<p>In short, we are hoping that we can estimate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math> (time since last infection) from <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math> (current antibody levels). If we could do that, then we could plug in our estimates <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>t</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><annotation encoding="application/x-tex">\hat t_i</annotation></semantics></math> into that likelihood above, and estimate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> as previously.</p>
<p>We‚Äôre actually going to do something a little more nuanced; instead of just using one value for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>t</mi><mo accent="true">ÃÇ</mo></mover><annotation encoding="application/x-tex">\hat t</annotation></semantics></math>, we are going to consider all possible values of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math> for each individual.</p>
<p>We need to link the data we actually observed to the incidence rate.</p>
<p>The likelihood of an individual‚Äôs observed data, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{p}(Y=y)</annotation></semantics></math>, can be expressed as an integral over the joint likelihood of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math> (using the Law of Total Probability):</p>
</div>
<div class="incremental">
<ul class="incremental">
<li><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mo>‚à´</mo><mi>t</mi></msub><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo>,</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\mathbb{p}(Y=y) = \int_t \mathbb{p}(Y=y,T=t)dt</annotation></semantics></math></li>
</ul>
<div class="notes">
<p>Further, we can express the joint probability <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo>,</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Y=y,T=t)</annotation></semantics></math> as the product of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(T=t)</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Y=y|T=t)</annotation></semantics></math> the ‚Äúantibody response curve after infection‚Äù. That is:</p>
</div>
<ul class="incremental">
<li><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo>,</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{p}(Y=y,T=t) = \mathbb{p}(Y=y|T=t) \mathbb{p}(T=t)</annotation></semantics></math></li>
</ul>
</div>
</section><section class="level2"><h3 id="antibody-response-curves">Antibody response curves<a class="anchor" aria-label="anchor" href="#antibody-response-curves"></a>
</h3>
<div id="fig-decay" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-decay-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig/fig1a-1.svg">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-decay-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure¬†2: Antibody response curves, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Y=y|T=t)</annotation></semantics></math>, for typhoid
</figcaption></figure>
</div>
</section><section class="level2"><h3 id="putting-it-all-together">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h3>
<p>Substituting <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo>,</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Y=y,T=t) = p(Y=y|T=t)P(T=t)</annotation></semantics></math> into the previous expression for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Y=y)</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mo>‚à´</mo><mi>t</mi></msub><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>t</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
p(Y=y)
&amp;= \int_t p(Y=y|T=t)P(T=t) dt
\end{aligned}
</annotation></semantics></math></p>
</section><section class="level2 smaller"><h3 class="smaller" id="composing-the-likelihood">Composing the likelihood<a class="anchor" aria-label="anchor" href="#composing-the-likelihood"></a>
</h3>
<div class="notes">
<p>Now, the likelihood of the observed data <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùê≤</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{y} = (y_1, y_2, ..., y_n)</annotation></semantics></math> is:</p>
</div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>‚Ñí</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munderover><mo>‚àè</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munderover><mo>‚àè</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mo>‚à´</mo><mi>t</mi></msub><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>p</mi><mi>Œª</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>t</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\mathcal{L}(\lambda)
&amp;= \prod_{i=1}^n p(Y=y_i)
\\&amp;= \prod_{i=1}^n \int_t p(Y=y_i|T=t)p_\lambda(T=t)dt\\
\end{aligned}
</annotation></semantics></math></p>
<div class="notes">
<p>If we know <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Y=y|T=t)</annotation></semantics></math>, then we can maximize <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>‚Ñí</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\lambda)</annotation></semantics></math> over <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> to find the ‚Äúmaximum likelihood estimate‚Äù (MLE) of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>, denoted <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>Œª</mi><mo accent="true">ÃÇ</mo></mover><annotation encoding="application/x-tex">\hat\lambda</annotation></semantics></math>.</p>
</div>
</section><section class="level2"><h3 id="finding-the-mle-numerically">Finding the MLE numerically<a class="anchor" aria-label="anchor" href="#finding-the-mle-numerically"></a>
</h3>
<div class="notes">
<p>The likelihood of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math> involves the product of integrals, so the log-likelihood involves the sum of the logs of integrals:</p>
</div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mo>log</mo><mi>‚Ñí</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>log</mo><munderover><mo>‚àè</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mo>‚à´</mo><mi>t</mi></msub><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>p</mi><mi>Œª</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>t</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo>log</mo><mrow><mo stretchy="true" form="prefix">{</mo><msub><mo>‚à´</mo><mi>t</mi></msub><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>p</mi><mi>Œª</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>t</mi><mo stretchy="true" form="postfix">}</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\log \mathcal{L} (\lambda)
&amp;= \log \prod_{i=1}^n \int_t p(Y=y_i|T=t)p_\lambda(T=t)dt\\
&amp;= \sum_{i=1}^n \log\left\{\int_t p(Y=y_i|T=t)p_\lambda(T=t)dt\right\}\\
\end{aligned}
</annotation></semantics></math></p>
<div class="notes">
<p>The derivative of this expression doesn‚Äôt come out cleanly, so we will use a <em>numerical method</em> (specifically, a Newton-type algorithm, implemented by <code><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">stats::nlm()</a></code>) to find the MLE and corresponding standard error.</p>
</div>
</section></section><section class="section level2"><h2 id="modeling-the-seroresponse-kinetics-curve">Modeling the seroresponse kinetics curve<a class="anchor" aria-label="anchor" href="#modeling-the-seroresponse-kinetics-curve"></a>
</h2>
<div class="notes">
<p>Now, we need a model for the antibody response to infection, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùï°</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{p}(Y=y|T=t)</annotation></semantics></math>. The current version of the <a href="https://github.com/UCD-SERG/serocalculator" class="external-link">serocalculator</a> package uses a two-phase model for the shape of the seroresponse <span class="citation" data-cites="Teunis_2016">[@Teunis_2016]</span>.</p>
</div>
<section class="level2 smaller"><h3 class="smaller" id="model-for-active-infection-period">Model for active infection period<a class="anchor" aria-label="anchor" href="#model-for-active-infection-period"></a>
</h3>
<div class="notes">
<p>The first phase of the model represents the <strong>active infection period</strong>, and uses a simplified Lotka-Volterra predator-prey model <span class="citation" data-cites="volterra1928variations">[@volterra1928variations]</span> where the pathogen is the prey and the antibodies are the predator:</p>
</div>
<p>Notation:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x(t)</annotation></semantics></math>: Pathogen concentration at time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y(t)</annotation></semantics></math>: Antibody concentration at time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
</li>
</ul>
<p>Model:</p>
<ul>
<li><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>‚Ä≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Œ±</mi><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>Œ≤</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x'(t) = \alpha x(t) - \beta y(t)</annotation></semantics></math></li>
<li><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mi>‚Ä≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Œ¥</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y'(t) = \delta y(t)</annotation></semantics></math></li>
</ul>
<div class="notes">
<p>With baseline antibody concentration <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">y(0) = y_{0}</annotation></semantics></math> and initial pathogen concentration <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x(0) = x_{0}</annotation></semantics></math>.</p>
</div>
<div class="notes">
<p>Compared to the standard LV model:</p>
<ul>
<li><p>the predation term with the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math> coefficient is missing the prey concentration <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x(t)</annotation></semantics></math> factor; we assume that the efficiency of predation doesn‚Äôt depend on pathogen concentration.</p></li>
<li><p>the differential equation for predator density is missing the predator death rate term <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>‚àí</mi><mi>Œ≥</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">-\gamma y(t)</annotation></semantics></math>; we assume that as long as there are any pathogens present, the antibody decay rate is negligible compared to the growth rate.</p></li>
<li><p>the predator growth rate term <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ¥</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\delta y(t)</annotation></semantics></math> is missing the prey density factor <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x(t)</annotation></semantics></math> we assume that as long as there are any pathogens present, the antibody concentration grows at the same exponential rate.</p></li>
</ul>
<p>These omissions were made to simplify the estimation process, under the assumption that they are negligible compared to the other terms in the model.</p>
</div>
</section><section class="level2"><h3 id="model-for-post-infection-antibody-decay">Model for post-infection antibody decay<a class="anchor" aria-label="anchor" href="#model-for-post-infection-antibody-decay"></a>
</h3>
<ul>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b(t) = 0</annotation></semantics></math></p></li>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mi>‚Ä≤</mi></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>‚àí</mi><mi>Œ±</mi><mi>y</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>r</mi></msup></mrow><annotation encoding="application/x-tex">y^{\prime}(t) = -\alpha y(t)^r</annotation></semantics></math></p></li>
</ul>
<div class="notes">
<p>Antibody decay is different from exponential (log‚Äìlinear) decay. When the shape parameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r &gt; 1</annotation></semantics></math>, log concentrations decrease rapidly after infection has terminated, but decay then slows down and low antibody concentrations are maintained for a long period. If <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r = 1</annotation></semantics></math>, this model reduces to exponential decay with decay rate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.</p>
</div>
</section><section class="level2"><h3 id="putting-it-all-together-1">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together-1"></a>
</h3>
<p>The serum antibody response <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y(t)</annotation></semantics></math> can be written as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>y</mi><mo>+</mo></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>y</mi><mo>‚àí</mo></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
y(t) = y_{+}(t) + y_{-}(t)
</annotation></semantics></math></p>
<p>where</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>y</mi><mo>+</mo></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><msup><mtext mathvariant="normal">e</mtext><mrow><mi>Œº</mi><mi>t</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>‚â§</mo><mi>t</mi><mo>&lt;</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>y</mi><mo>‚àí</mo></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>y</mi><mn>1</mn></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>y</mi><mn>1</mn><mrow><mi>r</mi><mo>‚àí</mo><mn>1</mn></mrow></msubsup><mi>Œ±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>‚àí</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>‚àí</mi><mfrac><mn>1</mn><mrow><mi>r</mi><mo>‚àí</mo><mn>1</mn></mrow></mfrac></mrow></msup><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>t</mi><mn>1</mn></msub><mo>‚â§</mo><mi>t</mi><mo>&lt;</mo><mi>‚àû</mi><mo stretchy="true" form="postfix">]</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
y_{+}(t) &amp; = y_{0}\text{e}^{\mu t}[0\leq t &lt;t_{1}]\\
y_{-}(t) &amp; = y_{1}\left(1+(r-1)y_{1}^{r-1}\alpha(t-t_{1})\right)^{-\frac{1}{r-1}}[t_{1}\le t &lt; \infty]
\end{align}
</annotation></semantics></math></p>
<hr>
<p>Since the peak level is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><msup><mtext mathvariant="normal">e</mtext><mrow><mi>Œº</mi><msub><mi>t</mi><mn>1</mn></msub></mrow></msup></mrow><annotation encoding="application/x-tex">y_{1} = y_{0}\text{e}^{\mu t_{1}}</annotation></semantics></math> the growth rate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math> can be written as <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mo>=</mo><mfrac><mn>1</mn><msub><mi>t</mi><mn>1</mn></msub></mfrac><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>y</mi><mn>1</mn></msub><msub><mi>y</mi><mn>0</mn></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu = \frac{1}{t_{1}}\log\left(\frac{y_{1}}{y_{0}}\right)</annotation></semantics></math></p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cur_ai</span> <span class="op">=</span> <span class="st">"HlyE_IgG"</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/UCD-SERG/serocalculator" class="external-link">serocalculator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co"># Import longitudinal antibody parameters from OSF</span></span>
<span><span class="va">curves</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://osf.io/download/rtw5k/"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/load_curve_params.html">load_curve_params</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iter</span> <span class="op">&lt;</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="va">curve1</span> <span class="op">=</span></span>
<span>  <span class="va">curves</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="co"># iter %in% 1:10,</span></span>
<span>    <span class="va">iter</span> <span class="op">==</span> <span class="fl">5</span>,</span>
<span>         <span class="va">antigen_iso</span> <span class="op">==</span> <span class="va">cur_ai</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">curve1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">serocalculator</span><span class="fu">:::</span><span class="fu"><a href="../reference/plot_curve_params_one_ab.html">plot_curve_params_one_ab</a></span><span class="op">(</span></span>
<span>  log_y <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">curve1</span><span class="op">$</span><span class="va">t1</span>,</span>
<span>        col <span class="op">=</span> <span class="st">"t1"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">curve1</span><span class="op">$</span><span class="va">y0</span>,</span>
<span>        col <span class="op">=</span> <span class="st">"y0"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">curve1</span><span class="op">$</span><span class="va">y1</span>,</span>
<span>        col <span class="op">=</span> <span class="st">"y1"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_point(</span></span>
<span>  <span class="co">#   data = curve1,</span></span>
<span>  <span class="co">#   aes(</span></span>
<span>  <span class="co">#     x = t1,</span></span>
<span>  <span class="co">#     y = y1,</span></span>
<span>  <span class="co">#     col = "(t1,y1)"</span></span>
<span>  <span class="co">#   )</span></span>
<span>  <span class="co"># ) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for x is already present.
Adding another scale for x, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-response-graph" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-response-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methodology_files/figure-html/fig-response-graph-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-response-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure¬†3: An example kinetics curve for HlyE IgG
</figcaption></figure>
</div>
</div>
</div>
<div class="notes">
<p>The antibody level at <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t=0</annotation></semantics></math> is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>0</mn></msub><annotation encoding="application/x-tex">y_{0}</annotation></semantics></math>; the rising branch ends at <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t = t_{1}</annotation></semantics></math> where the peak antibody level <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_{1}</annotation></semantics></math> is reached. Any antibody level <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àà</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mn>0</mn></msub><mo>,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y(t) \in (y_{0}, y_{1})</annotation></semantics></math> eventually occurs twice.</p>
</div>
<hr>
<div class="notes">
<p>An interactive Shiny app that allows the user to manipulate the model parameters is available at:</p>
<p><a href="https://ucdserg.shinyapps.io/antibody-kinetics-model-2/" class="external-link uri">https://ucdserg.shinyapps.io/antibody-kinetics-model-2/</a></p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="../reference/figures/qr_akm2.svg"></p>
<figcaption>QR code for shiny app</figcaption></figure>
</div>
</section><section class="level2"><h3 id="biological-noise">Biological noise<a class="anchor" aria-label="anchor" href="#biological-noise"></a>
</h3>
<div class="notes">
<p>When we measure antibody concentrations in a blood sample, we are essentially counting molecules (using biochemistry).</p>
<p>We might miss some of the antibodies (undercount, false negatives) and we also might incorrectly count some other molecules that aren‚Äôt actually the ones we are looking for (overcount, false positives, cross-reactivity).</p>
<p>We are more concerned about overcount (cross-reactivity) than undercount. For a given antibody, we can do some analytical work beforehand to estimate the distribution of overcounts, and add that to our model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Y=y|T=t)</annotation></semantics></math>.</p>
</div>
<p>Notation:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mtext mathvariant="normal">obs</mtext></msub><annotation encoding="application/x-tex">y_\text{obs}</annotation></semantics></math>: measured serum antibody concentration</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mtext mathvariant="normal">true</mtext></msub><annotation encoding="application/x-tex">y_\text{true}</annotation></semantics></math>: ‚Äútrue‚Äù serum antibody concentration</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œµ</mi><mi>b</mi></msub><annotation encoding="application/x-tex">\epsilon_b</annotation></semantics></math>: noise due to probe cross-reactivity</li>
</ul>
<p>Model:</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mtext mathvariant="normal">obs</mtext></msub><mo>=</mo><msub><mi>y</mi><mtext mathvariant="normal">true</mtext></msub><mo>+</mo><msub><mi>œµ</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">y_\text{obs} = y_\text{true} + \epsilon_b</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œµ</mi><mi>b</mi></msub><mo>‚àº</mo><mtext mathvariant="normal">Unif</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>ŒΩ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon_b \sim \text{Unif}(0, \nu)</annotation></semantics></math></li>
</ul>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ŒΩ</mi><annotation encoding="application/x-tex">\nu</annotation></semantics></math> needs to be pre-estimated using negative controls, typically using the 95th percentile of the distribution of antibody responses to the antigen-isotype in a population with no exposure.</p>
</section><section class="level2"><h3 id="measurement-noise">Measurement noise<a class="anchor" aria-label="anchor" href="#measurement-noise"></a>
</h3>
<p>There are also some other sources of noise in our bioassays; user differences in pipetting technique, random ELISA plate effects, etc. This noise can cause both overcount and undercount. We can also estimate the magnitude of this noise source, and include it in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Y=y|T=t)</annotation></semantics></math>.</p>
<p>Measurement noise, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œµ</mi><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math> (‚Äúepsilon‚Äù), represents measurement error from the laboratory testing process. It is defined by a CV (coefficient of variation) as the ratio of the standard deviation to the mean for replicates. Note that the CV should ideally be measured across plates rather than within the same plate.</p>
<!-- {{< include articles/_methods-continued.qmd >}} -->
</section><section class="level2 smaller unnumbered"><h3 class="smaller unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" role="list">

</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Peter Teunis, Kristina Lai, Chris Orwa, Kristen Aiemjoy, Douglas Ezra Morrison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
