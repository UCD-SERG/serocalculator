<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="serocalculator">
<title>Serocalculator package tutorial • serocalculator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Serocalculator package tutorial">
<meta property="og:description" content="serocalculator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">serocalculator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/sees_analysis.html">sees-analysis</a>
    <a class="dropdown-item" href="../articles/example-analysis.html">example-analysis</a>
    <a class="dropdown-item" href="../articles/installation.html">Serocalculator package installation manual</a>
    <a class="dropdown-item" href="../articles/methodology.html">Serocalculator package methodology</a>
    <a class="dropdown-item" href="../articles/simulation.html">simulation</a>
    <a class="dropdown-item" href="../articles/tutorial.html">Serocalculator package tutorial</a>
    <a class="dropdown-item" href="../articles/typhoid-controls.html">typhoid-controls</a>
    <a class="dropdown-item" href="../articles/typhoid-seroincidence.html">Typhoid Seroincidence</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/UCD-SERG/serocalculator/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Serocalculator package tutorial</h1>
                        <h4 data-toc-skip class="author">UC Davis
SeroEpidemiology Group</h4>
            
            <h4 data-toc-skip class="date">2023-11-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/UCD-SERG/serocalculator/blob/HEAD/vignettes/tutorial.Rmd" class="external-link"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </div>

    
    
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script><div style="page-break-after: always;"></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Antibody levels measured in a (cross–sectional) population sample can
be translated into an estimate of the frequency with which
seroconversions (infections) occur in the sampled population. In simple
terms: the presence of many high antibody concentrations indicates that
many subjects likely experienced infection recently, while mostly low
concentrations indicate a low frequency of infections in the sampled
population. More information about ELISA methods can be found on <a href="https://www.ecdc.europa.eu/en/publications-data/seroincidence-calculator-tool" class="external-link">ECDC
web site</a>.</p>
<p>In order to thus interpret the measured cross-sectional antibody
concentrations, characteristics of the time course of the serum antibody
response must be known. For any antibody detected in the cross–sectional
sample, a quantitative description of its dynamics following infection
(seroconversion to an elevated concentration, followed by a gradual
decrease) must be available. In published studies, this information on
the time course of the serum antibody response has been obtained from
follow–up data in subjects who had a symptomatic episode following
infection. The onset of symptoms thus provided a proxy for the time that
infection occurred. Care must be taken that longitudinal and
cross–sectional measurements of antibody concentrations are calibrated
on the same scale (or, preferably, expressed in identical units).</p>
<p>The time course of the serum antibody response to infection is
assumed generic: anyone infected by the same pathogen is expected to
produce a response similar to those seen in the symptomatic cohort used
for the follow–up study. Thus, the strategy is to set up a longitudinal
model from a follow–up study once, and use the thus obtained information
to analyze many different cross–sectional data sets.</p>
<p>Note that it must be assumed that such variation in the time course
of antibody concentrations among individuals as observed in the
longitudinal cohort is the same as in the population where the
cross-sectional sample was taken, where this variation cannot be
observed.</p>
<p>Analysis of longitudinal data and estimation of the required
parameters is separated from the estimation of seroincidences, because
(1) there are few longitudinal data sets available and they are
difficult (and expensive) to obtain, (2) such longitudinal models may be
considered <em>generic</em>, presumably describing a physiological
phenomenon that is similiar in any infected individual, and (3) setting
up and running the longitudinal model requires additional skills, not
necessary for use of the sero–incidence calculator script</p>
</div>
<div class="section level2">
<h2 id="the-seroincidence-estimator">The seroincidence estimator<a class="anchor" aria-label="anchor" href="#the-seroincidence-estimator"></a>
</h2>
<p>Package <strong>serocalculator</strong> was designed to calculate
incidence of seroconversion, by using the longitudinal seroresponse
characteristics. The distribution of serum antibody concentrations in a
cross–sectional population sample is calculated, as a function of the
(longitudinal) seroresponse and the frequency of seroconversion (or
seroincidence). Given the seroresponse, this (marginal) distribution of
antibody concentrations can be fitted to the cross-sectional data, by
adjusting the seroconversion frequency, thus providing a means to
estimate the seroconversion frequency.</p>
<div class="section level3">
<h3 id="time-course-of-serum-antibodies">Time course of serum antibodies<a class="anchor" aria-label="anchor" href="#time-course-of-serum-antibodies"></a>
</h3>
<p>The seroresponse, the time course of serum antibodies following
seroconversion (infection) is described by means of a set of parameters
describing it. These parameters may include:</p>
<ol style="list-style-type: lower-alpha">
<li>baseline antibody concentration,</li>
<li>time to reach peak antibody concentration,</li>
<li>magnitude of the peak concentration, and</li>
<li>antibody decay parameters describing the time course (shape and
rate) of antibody decay.</li>
</ol>
<p>A model description that is used for the serocalculator is described
in <span class="citation">(Simonsen et al. 2009; P. Teunis et al.
2012)</span>. An alternative model, simplified but with improved
interpretation of the underlying biological mechanisms, is given in
<span class="citation">(Graaf et al. 2014)</span> and further improved
in <span class="citation">(P. F. M. Teunis et al. 2016)</span>.</p>
<p>The current model assumes that upon exposure to an initial inoculum,
pathogen concentrations increase exponentially. Presence of pathogens
(antigen presented to the immune system) signals an increase in antibody
production, resulting in exponentially increasing serum antibody
concentrations. Increased activity of the immune system, as signalled by
circulating antibodies, causes inactivation or die–off of pathogens,
with a rate proportional to the serum antibody concentration.
Ultimately, when all pathogens are removed, infection is over and the
promotion of antibody production stops. Then the decay phase starts, and
serum antibody concentrations decrease. Antibody decay in the serum
compartment may start fast and slow down later, resulting in
non–exponential decay. In <span class="citation">(P. F. M. Teunis et al.
2016)</span> this is modelled using a shape parameter, allowing gradual
adjustment between exponential (log–linear) and strongly non–exponential
decay.</p>
</div>
<div class="section level3">
<h3 id="heterogenity">Heterogenity<a class="anchor" aria-label="anchor" href="#heterogenity"></a>
</h3>
<p>The five parameters describing the seroresponse (in round brackets
names of corresponding parameters used in the package, see <a href="#longParams">section 3.2.2</a> for details): baseline antibody
concentration (<code>y0</code> and <code>yb</code>), time to peak
(<code>t1</code>), peak antibody concentration (<code>y1</code>), decay
rate (<code>alpha</code>) and shape factor of the decay curve
(<code>r</code>) are not fixed numbers. In a population of subjects,
individuals each have their own seroresponse, different from those of
other subjects. Therefore, these parameters are provided as a (joint)
distribution, describing their variation among individuals in the
sampled population. Of course, such a distribution depends on the
pathogen, the detected antibody, and even the detection assay.</p>
<p>Estimates for these seroresponse parameters may be obtained by
fitting the model to longitudinal data. Typically, such data are
collected in patients with confirmed infection, where the time of
infection is detected by appearance of symptoms. Ideally, blood samples
are taken at several times post infection, up to a period long enough to
reliably estimate the shape of the serum antibody decay curve.</p>
<p>A Bayesian hierarchical framework allows for individual variation in
seroresponses, so that one obtains the (posterior) joint distribution of
the parameters as a (Markov chain) Monte Carlo sample, of all relevant
parameters <span class="citation">(P. F. M. Teunis et al.
2016)</span>.</p>
<p>Note that, due to the limited number of iterations in the Monte Carlo
sample, the generated incidence estimates will show minor variations: if
the same calculation is run twice, the outcomes may differ slightly. If
this variation should be smaller, the size of the Monte Carlo sample may
be increased. This however will slow down the calculations.</p>
</div>
<div class="section level3">
<h3 id="incidence-estimation">Incidence estimation<a class="anchor" aria-label="anchor" href="#incidence-estimation"></a>
</h3>
<p>The longitudinal seroresponses are considered generic: they represent
the time course of (specific) human serum antibodies against a
(specific) pathogen. Therefore, with any cross–sectional sample of the
same antibodies in a human population, an incidence estimate can be
calculated.</p>
<p>Given the longitudinal response characteristics,
<strong>serocalculator</strong> R package provide a rapid and
computationally simple method for calculating seroconversion rates, as
published in <span class="citation">(P. Teunis et al. 2012)</span>.</p>
<p>The methods on which the seroincidence calculator is based were
developed with publicly funded research. All procedures have been
published and are open to the general public, including the core script
on which the seroincidence calculator is based. To make the
functionalities provided as broadly available as possible, R was chosen
as the computing platform, because it is free and open source, and runs
on any modern computer operating system.</p>
</div>
<div class="section level3">
<h3 id="model-variants">Model variants<a class="anchor" aria-label="anchor" href="#model-variants"></a>
</h3>
<p>The package contains longitudinal models for seroincidence
calculations. Four model variants are possible, depending on whether
seroconversion is instantaneous (<span class="math inline">\(t_{1} =
0\)</span>) or not (<span class="math inline">\(t_{1} &gt; 0\)</span>),
and whether decay is exponential (<span class="math inline">\(r =
1\)</span>) or proceeds as a power function (<span class="math inline">\(r &gt; 1\)</span>). Power function decay allows
for rapid inital decay followed by a sustained period of very slow decay
<span class="citation">(<strong>4?</strong>)</span>. Available model
variants are described in Table @ref(tab:model-variants) and Table
@ref(tab:model-variants-available).</p>
<table class="table">
<caption>(#tab:model-variants) Model variants</caption>
<colgroup>
<col width="36%">
<col width="36%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th>Model</th>
<th>Time to<br>Seroconversion<br>(<span class="math inline">\(t_{1}\)</span>)</th>
<th>Decay<br>parameter<br>(<span class="math inline">\(r\)</span>)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>&gt; 1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>&gt; 0</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>&gt; 0</td>
<td>&gt; 1</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>(#tab:model-variants-available) Models variants available by
pathogen, antibody, and units:</caption>
<thead><tr class="header">
<th>Pathogen</th>
<th>Antibody</th>
<th>Units</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><em>Campylobacter jejuni</em></td>
<td>IgG</td>
<td>ELISA (Delft)</td>
<td>*</td>
<td></td>
<td>*</td>
<td>*</td>
</tr>
<tr class="even">
<td></td>
<td>IgM</td>
<td>ELISA (Delft)</td>
<td>*</td>
<td></td>
<td>*</td>
<td>*</td>
</tr>
<tr class="odd">
<td></td>
<td>IgA</td>
<td>ELISA (Delft)</td>
<td>*</td>
<td></td>
<td>*</td>
<td>*</td>
</tr>
<tr class="even">
<td></td>
<td>IgG</td>
<td>ELISA (SSI)</td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr class="odd">
<td></td>
<td>IgM</td>
<td>ELISA (SSI)</td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr class="even">
<td></td>
<td>IgA</td>
<td>ELISA (SSI)</td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr class="odd">
<td><em>Salmonella</em></td>
<td>IgG</td>
<td>mixed ELISA (SSI)</td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr class="even">
<td></td>
<td>IgM</td>
<td>mixed ELISA (SSI)</td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr class="odd">
<td></td>
<td>IgA</td>
<td>mixed ELISA (SSI)</td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr class="even">
<td><em>Bordetella pertussis</em></td>
<td>IgG-PT</td>
<td>IU</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="how-to-use-serocalculator-package">How to use <em>serocalculator</em> package<a class="anchor" aria-label="anchor" href="#how-to-use-serocalculator-package"></a>
</h2>
<p>This section provides step-by-step directions on the usage of the
<em>serocalculator</em> package.</p>
<div class="section level3">
<h3 id="loading-the-package">Loading the package<a class="anchor" aria-label="anchor" href="#loading-the-package"></a>
</h3>
<p>Functionality of the <em>serocalculator</em> package is made
available to the end user only once the library is loaded into the
current workspace. Assuming the package is installed already (covered in
<a href="installation.pdf">installation.pdf</a>) loading is achieved by
running the following command in the R console (bear in mind that the
text after character <code>#</code> is only a comment):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package "seroincidence"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/UCD-SERG/serocalculator" class="external-link">serocalculator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<p>At this moment all functions required to run the seroincidence
calculation are made available. It can be checked by running:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List all objects (functions and data) exposed by package "serocalculator".</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="st">"package:serocalculator"</span><span class="op">)</span></span></code></pre></div>
<p>Here is the resulting output:</p>
<pre><code><span><span class="co">##  [1] "campylobacterDelftParams1"  "campylobacterDelftParams3" </span></span>
<span><span class="co">##  [3] "campylobacterDelftParams4"  "campylobacterSimHighData"  </span></span>
<span><span class="co">##  [5] "campylobacterSimLowData"    "campylobacterSimMediumData"</span></span>
<span><span class="co">##  [7] "campylobacterSSIParams1"    "campylobacterSSIParams2"   </span></span>
<span><span class="co">##  [9] "campylobacterSSIParams4"    "est.incidence"             </span></span>
<span><span class="co">## [11] "est.incidence.by"           "fdev"                      </span></span>
<span><span class="co">## [13] "getAdditionalData"          "pertussisIgGPTParams1"     </span></span>
<span><span class="co">## [15] "pertussisIgGPTParams2"      "pertussisIgGPTParams3"     </span></span>
<span><span class="co">## [17] "pertussisIgGPTParams4"      "pertussisSimHighData"      </span></span>
<span><span class="co">## [19] "pertussisSimLowData"        "pertussisSimMediumData"    </span></span>
<span><span class="co">## [21] "postprocess_fit"            "salmonellaSSIParams1"      </span></span>
<span><span class="co">## [23] "salmonellaSSIParams2"       "salmonellaSSIParams4"      </span></span>
<span><span class="co">## [25] "typhoid_controls"           "typhoid_noise_params"</span></span></code></pre>
<p>We briefly describe the most important objects and functions:</p>
<ol style="list-style-type: lower-alpha">
<li>
<code>[DISEASE]Params[MODEL_TYPE]</code>: Monte Carlo sample of
longitudinal response parameters per antibody for various diseases:
Campylobacter, Pertussis, Salmonella. Object class:
<code>list</code>.</li>
<li>
<code>[DISEASE]Sim[Low|Medium|High]Data</code>: Example simulated
antibody levels data measured in a cross-sectional population for three
values of lambda (incidence): 0.036 (“Low”), 0.21 (“Medium”) and 1.15
(“High”) (1/yr). Object class: <code>data.frame</code>.</li>
<li>
<code>getAdditionalData</code>: Utility function for downloading
additional longitudinal response parameters from an online repository.
Files available for download are <code>coxiellaIFAParams4.zip</code> and
<code>yersiniaSSIParams4.zip</code>. Object class:
<code>function</code>.</li>
<li>
<code>est.incidence.by</code>: Main function of the package.
Estimates seroincidence based on supplied cross-section antibody levels
data and longitudinal response parameters. Object class:
<code>function</code>.</li>
</ol>
</div>
<div class="section level3">
<h3 id="specifying-input-data">Specifying input data<a class="anchor" aria-label="anchor" href="#specifying-input-data"></a>
</h3>
<p>There are two sets of inputs to the serology calculator that must
always be specified:</p>
<ol style="list-style-type: lower-alpha">
<li>Simulated antibody levels measured in cross-sectional population
sample (see <code>campylobacterSimLowData</code>,
<code>campylobacterSimMediumData</code>, etc. above).</li>
<li>Longitudinal response characteristic as set of parameters
<code>(y1, alpha, yb, r, y0, mu1, t1)</code> (see
<code>campylobacterDelftParams1</code>,
<code>campylobacterSSIParams2</code>, etc. above).</li>
</ol>
<p>We start with loading antibody levels measured in cross-sectional
population sample.</p>
<div class="section level4">
<h4 id="specifying-cross-sectional-antibody-levels-data">Specifying cross-sectional antibody levels data<a class="anchor" aria-label="anchor" href="#specifying-cross-sectional-antibody-levels-data"></a>
</h4>
<p>The user has a few options of providing this data to the
calculator:</p>
<p><strong>i) Using supplied sample data</strong></p>
<p>Data set <code>campylobacterSimMediumData</code> provides an example
of a cross-sectional antibody levels data for Campylobacter. It is
loaded into the workspace as soon as the package is loaded, therefore it
can be referenced right away. Here is a small exempt from this data
set:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show three first rows of "campylobacterSimMediumData" data.frame.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">campylobacterSimMediumData</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         Age       IgG        IgM          IgA</span></span>
<span><span class="co">## 1  4530.743 0.2242790 0.05442598 1.138591e-02</span></span>
<span><span class="co">## 2  5173.256 0.8498734 0.10667042 2.093677e-06</span></span>
<span><span class="co">## 3 24187.164 0.1849355 1.24958865 1.652755e-01</span></span></code></pre>
<p>Let us create the serology data <code>serologyData</code> based on
this data set:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign data.frame "campylobacterDelftData" to object named "serologyData".</span></span>
<span><span class="va">serologyData</span> <span class="op">&lt;-</span> <span class="va">campylobacterSimMediumData</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AgeCat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">Age</span>, <span class="fl">15</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print a few first observations.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">serologyData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         Age       IgG          IgM          IgA AgeCat</span></span>
<span><span class="co">## 1  4530.743 0.2242790 0.0544259797 1.138591e-02      3</span></span>
<span><span class="co">## 2  5173.256 0.8498734 0.1066704172 2.093677e-06      3</span></span>
<span><span class="co">## 3 24187.164 0.1849355 1.2495886495 1.652755e-01     14</span></span>
<span><span class="co">## 4 21427.836 1.1743485 0.0001590331 3.122555e-02     12</span></span>
<span><span class="co">## 5 12560.687 1.0656224 0.0013906805 8.723256e-04      7</span></span>
<span><span class="co">## 6 17083.219 0.1115373 0.4976598547 2.321977e-01     10</span></span></code></pre>
<p>You can view the data also in a tabular form:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">serologyData</span><span class="op">)</span></span></code></pre></div>
<p>We shall pass this object later to the calculator. Object
<code>serologyData</code> must contain at least one column named
<code>IgG</code>, <code>IgM</code>, or <code>IgA</code>. Additionally,
column <code>Age</code> is used in the calculations if it is present.
Otherwise, it is created on-the-fly and initialized to <code>NA</code>
(not available). Column <code>Age</code>, if supplied, is assumed to
represent age in days.</p>
<p>Please, note that the cross-sectional data set can include extra
columns allowing performing the seroincidence calculations stratified
per factors available in those data. In the example above column
<code>AgeCat</code> can be used as a <em>stratum</em> variable. This
particular variable is created by mapping the age in days (column
<code>Age</code>) into 15 categories, category 1 grouping the youngest
subjects and category 15 grouping the oldest subjects.</p>
<p><strong>ii) Loading from external files</strong></p>
<p>The user can load her/his own data into an R session. Details on
loading specific file types can be found in online R manual on <a href="http://cran.r-project.org/doc/manuals/r-release/R-data.html" class="external-link">R
Data Import/Export</a>.</p>
<p>It is important that the input data is in a tabular form with each
column containing levels measured for a single antibody type. Column
name should indicate name of the measured antibody. For instance, a
comma separated file with the following content:</p>
<pre><code>IgG, IgM, IgA
5.337300, 0.4414653, 0.3002395
3.534118, 0.3888226, 0.3543486
2.144549, 0.3320178, 0.3884205
2.957854, 0.4967764, 0.3472340</code></pre>
<p>is a valid cross-sectional data set. Suppose this file is named
<code>c:\cross-sectional-data.csv</code>. Then it can be loaded into R
like this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read content of file "C:\cross-sectional-data.csv" into object named </span></span>
<span><span class="co"># "serologyData".</span></span>
<span><span class="va">serologyData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"C:\\cross-sectional-data.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="longParams">Specifying longitudinal response parameters<a class="anchor" aria-label="anchor" href="#longParams"></a>
</h4>
<p>The longitudinal response parameters set consists of the following
items:</p>
<ul>
<li>
<code>y1</code>: antibody peak level (ELISA units)</li>
<li>
<code>alpha</code>: antibody decay rate (1/days for the current
longitudinal parameter sets)</li>
<li>
<code>yb</code>: baseline antibody level at <span class="math inline">\(t\)</span> approaching infinity (<span class="math inline">\(y(t-&gt;inf)\)</span>)</li>
<li>
<code>r</code>: shape factor of antibody decay</li>
<li>
<code>y0</code>: baseline antibody level at <span class="math inline">\(t=0\)</span> (<span class="math inline">\(y(t=0)\)</span>)</li>
<li>
<code>mu1</code>: initial antibody growth rate</li>
<li>
<code>t1</code>: duration of infection</li>
</ul>
<p>Please, refer to vignette <a href="methodology.pdf">methodology.pdf</a> for more details on the
underlying methodology.</p>
<p>End user has three options for loading the response parameters into R
session:</p>
<p><strong>i) Using supplied data</strong></p>
<p>There are a few longitudinal response parameter data sets provided by
the package including Monte-Carlo sample of longitudinal response
parameters, like <code>campylobacterDelftParams4</code>. This particular
object is a list containing three data.frame objects named
<code>IgG</code>, <code>IgM</code> and <code>IgA</code>. Let’s have a
pick into each of these two data sets separately (notice character
<code>$</code> indicating a sub-object of the parent object):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show first rows of data.frame "IgG" in list "campylobacterDelftParams4".</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">campylobacterDelftParams4</span><span class="op">$</span><span class="va">IgG</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          y1        alpha yb        r         y0       mu1       t1</span></span>
<span><span class="co">## 1 27.861427 0.0051607511  0 1.019014 0.07791154 0.7296875 8.057456</span></span>
<span><span class="co">## 2  3.306758 0.0011913102  0 1.099056 0.05077868 0.8435221 4.950963</span></span>
<span><span class="co">## 3 18.791581 0.0006869688  0 1.010531 0.09212040 0.6116469 8.694670</span></span>
<span><span class="co">## 4  5.866064 0.0006929407  0 1.019739 0.07694126 0.5232645 8.282421</span></span>
<span><span class="co">## 5 14.364930 0.0035222413  0 1.092096 0.05110497 0.9445758 5.969519</span></span>
<span><span class="co">## 6  5.790477 0.0003697673  0 1.010602 0.09127834 0.7696968 5.391807</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show first rows of data.frame "IgM" in list "campylobacterDelftParams4".</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">campylobacterDelftParams4</span><span class="op">$</span><span class="va">IgM</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          y1        alpha yb        r         y0       mu1       t1</span></span>
<span><span class="co">## 1 3.0218848 0.0068170529  0 1.073372 0.09900034 0.3980767 8.587573</span></span>
<span><span class="co">## 2 1.4605254 0.0004345318  0 1.042603 0.07462244 0.4741715 6.272224</span></span>
<span><span class="co">## 3 2.1067968 0.0043837064  0 1.068606 0.10507351 0.4748134 6.314615</span></span>
<span><span class="co">## 4 1.1187181 0.0019154929  0 1.071340 0.09971466 0.3124635 7.737306</span></span>
<span><span class="co">## 5 0.4222472 0.0005651563  0 1.000181 0.12935880 0.5040532 2.346977</span></span>
<span><span class="co">## 6 4.5818356 0.0158849155  0 1.071558 0.10262796 0.6777377 5.605037</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show first rows of data.frame "IgA" in list "campylobacterDelftParams4".</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">campylobacterDelftParams4</span><span class="op">$</span><span class="va">IgA</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          y1        alpha yb        r         y0       mu1        t1</span></span>
<span><span class="co">## 1 2.7471594 0.0235920904  0 2.773443 0.06452524 0.2737697 13.702269</span></span>
<span><span class="co">## 2 0.3361973 0.0001511561  0 1.006182 0.13241137 0.6774068  1.375517</span></span>
<span><span class="co">## 3 1.3402570 0.0072306458  0 1.640734 0.12395023 0.3883815  6.129892</span></span>
<span><span class="co">## 4 7.8335091 0.0028906244  0 2.768401 0.06512216 0.3482461 13.754356</span></span>
<span><span class="co">## 5 0.3069594 0.0029306951  0 1.050954 0.07870162 0.4218624  3.226293</span></span>
<span><span class="co">## 6 1.6315826 0.0044291436  0 1.740029 0.12264517 0.5924527  4.368299</span></span></code></pre>
<p>Let us assign object <code>campylobacterDelftParams4</code> to
variable <code>responseParams</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">responseParams</span> <span class="op">&lt;-</span> <span class="va">campylobacterDelftParams4</span></span></code></pre></div>
<p><strong>ii) Loading from local external files</strong></p>
<p>Alternatively, this data can be loaded from an external file. Bear in
mind, that most likely your data is organized into three files,
separately for antibody <code>IgG</code>, <code>IgM</code> and
<code>IgA</code>. Assuming that the data is saved into csv files named
<code>IgG.csv</code>, <code>IgM.csv</code> and <code>IgA.csv</code> the
end user would run the following code in order to create a valid input
to the calculator:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IgGData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"IgG.csv"</span><span class="op">)</span></span>
<span><span class="va">IgMData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"IgM.csv"</span><span class="op">)</span></span>
<span><span class="va">IgAData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"IgA.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a list named "responseData" containing objects named "IgG", "IgM" and </span></span>
<span><span class="co"># "IgA".</span></span>
<span><span class="va">responseParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>IgG <span class="op">=</span> <span class="va">IgGData</span>, IgM <span class="op">=</span> <span class="va">IgMData</span>, IgA <span class="op">=</span> <span class="va">IgAData</span><span class="op">)</span></span></code></pre></div>
<p>Note that object <code>responseParams</code> is a list with three
dataframes named <code>IgG</code>, <code>IgM</code> and <code>IgA</code>
as required.</p>
<p><strong>iii) Loading from an external repository</strong></p>
<p>Finally, response parameters can be obtained from an online
repository set up for this package. The repository is hosted on ECDC
servers. At the time of publishing this package two files are
available:</p>
<ol style="list-style-type: lower-alpha">
<li>
<code>coxiellaIFAParams4.zip</code>: longitudinal response
parameters per antibody for Coxiella.</li>
<li>
<code>yersiniaSSIParams4.zip</code>: longitudinal response
parameters per antibody for Yersinia.</li>
</ol>
<p>Simply use the supplied utility function
<code>getAdditionalData</code> to download this data:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">responseParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getAdditionalData.html">getAdditionalData</a></span><span class="op">(</span><span class="st">"coxiellaIFAParams4.zip"</span><span class="op">)</span></span></code></pre></div>
<p>Internet connection is needed for this function to work.</p>
</div>
</div>
<div class="section level3">
<h3 id="estimating-seroincidence">Estimating seroincidence<a class="anchor" aria-label="anchor" href="#estimating-seroincidence"></a>
</h3>
<p>Main calculation function provided by package <em>serocalculator</em>
is called <code>est.incidence.by</code>. It takes several arguments:</p>
<ul>
<li>
<code>data</code>: A data frame with the cross-sectional data (see
variable <code>serologyData</code> above). This may be the whole data
set loaded from file, but can also be a subset,
e.g. <code>data = serologyData[1, ]</code> to use only the first row. In
this tutorial this is the data loaded into variable
<code>serologyData</code>. It is a required input.</li>
<li>
<code>antibodies</code>: A list of antibodies to be used. This can
be a triplet (<code>antibodies = c("IgG", "IgM", "IgA")</code>) or any
single antibody (<code>antibodies = c("IgG")</code>) or a combination of
any two antibodies. It is a required input.</li>
<li>
<code>strata</code>: A list of categories to stratify data. The
column <code>AgeCat</code> in the example data set can be used as an
example. If <code>strata = ""</code> (default), then the whole data set
is treated as a single stratum; if each sample is assigned a unique
identifier (e.g. <code>strata = "AgeCat"</code>) there are as many
strata as there are samples and an incidence estimate is calculated for
each sample. If not specified, then <code>strata</code> is initialized
to <code>""</code>.</li>
<li>
<code>params</code>: A list with the longitudinal parameters for all
antibodies specified. In this tutorial this is the data loaded into
variable <code>responseParams</code>. It is a required input.</li>
<li>
<code>censorLimits</code>: A list of cutoff levels, one for each
antibody used. These are antibody levels below which observations should
be treated as censored. It is a required input.</li>
<li>
<code>par0</code>: List of parameters for the (lognormal)
distribution of antibody concentrations for true seronegatives
(i.e. those who never seroconverted), by named antibody type
(corresponding to <code>data</code>).</li>
<li>
<code>start</code> A starting value for <code>log.lambda</code>.
Value of -6 corresponds roughly to 1 day (<code>log(1/365.25)</code>),
value of -4 corresponds roughly to 1 week (<code>log(7/365.25)</code>).
Users are adivised to experiment with this value to confirm that
convergence to the same estimate is obtained. Default is -6.</li>
<li>
<code>numCores</code> Number of processor cores to use for
calculations when computing by <code>strata</code>. If set to more than
1 and R package <code>parallel</code> is available (installed by
default), then the computations by stratum are executed in parallel.
Default is 1, ie. no execution in parallel.</li>
</ul>
<p>Here is an example of the <em>Campylobacter</em> seroincidence
calculation for three antibodies measured, stratified per
<code>AgeCat</code>, and with measurements below <code>0.1</code>
removed:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare input data.</span></span>
<span><span class="va">serologyData</span> <span class="op">&lt;-</span> <span class="va">campylobacterSimMediumData</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    AgeCat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">Age</span>, <span class="fl">15</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    Age <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">responseParams</span> <span class="op">&lt;-</span> <span class="va">campylobacterDelftParams4</span></span>
<span></span>
<span><span class="va">cutOffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>IgG <span class="op">=</span> <span class="fl">0.1</span>, IgM <span class="op">=</span> <span class="fl">0.1</span>, IgA <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Baseline distributions: the distributions of antibody concentrations in </span></span>
<span><span class="co"># subjects who have never seroconverted.</span></span>
<span><span class="va">baseLine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>IgG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 IgM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.005</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 IgA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.005</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign output of function "est.incidence.by" to object named </span></span>
<span><span class="co"># "seroincidenceData". Use all available processor cores.</span></span>
<span><span class="va">seroincidenceData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est.incidence.by.html">est.incidence.by</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">serologyData</span>,</span>
<span>  antibodies <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IgG"</span>, <span class="st">"IgM"</span>, <span class="st">"IgA"</span><span class="op">)</span>,</span>
<span>  strata <span class="op">=</span> <span class="st">"AgeCat"</span>,</span>
<span>  params <span class="op">=</span> <span class="va">responseParams</span>,</span>
<span>  censorLimits <span class="op">=</span> <span class="va">cutOffs</span>,</span>
<span>  par0 <span class="op">=</span> <span class="va">baseLine</span>,</span>
<span>  numCores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  start <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show content of the output variable...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">seroincidenceData</span><span class="op">)</span></span>
<span><span class="co"># ...or simply type in the console: 'seroincidenceData' (without "'") and </span></span>
<span><span class="co"># press ENTER.</span></span></code></pre></div>
<p>The following text should be printed.</p>
<pre><code><span><span class="co">## Seroincidence object estimated given the following setup:</span></span>
<span><span class="co">## a) Antibodies   : IgG, IgM, IgA</span></span>
<span><span class="co">## b) Strata       : AgeCat </span></span>
<span><span class="co">## c) Censor limits:  IgG = 0.1, IgM = 0.1, IgA = 0.1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## This object is a list containing the following items:</span></span>
<span><span class="co">## Fits         - List of outputs of "optim" function per stratum.</span></span>
<span><span class="co">## Antibodies   - Input parameter antibodies of function "est.incidence.by".</span></span>
<span><span class="co">## Strata       - Input parameter strata of function "est.incidence.by".</span></span>
<span><span class="co">## CensorLimits - Input parameter censorLimits of function "est.incidence.by".</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call summary function to obtain output results.</span></span></code></pre>
<p>The most important output is subobject <code>Fits</code> containing
raw results on the output incidence. Translation of these raw results is
provided by a custom function <code>summary</code> explained in the
following section.</p>
<p>The cutoff argument is based on censoring of the observed serum
antibody measurements <span class="citation">(Strid et al. 2001)</span>.
Cut-off levels must always be specified when calling function
<code>est.incidence.by</code> (argument <code>censorLimits</code>).
Value <code>0</code> should be set for antibody measurements where no
censoring is needed, for instance</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">censorLimits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>IgG <span class="op">=</span> <span class="fl">0</span>, IgM <span class="op">=</span> <span class="fl">0</span>, IgA <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Using different censoring levels will produce different results.
Choosing higher cut-off causes the estimates of lambda to decrease.
Results should be published together with the chosen cut-off values. The
cut-off level of <code>0.1</code> set in the example above is a typical
value, but users should set it to value reflecting the censoring level
in the data.</p>
</div>
<div class="section level3">
<h3 id="getting-a-summary-of-seroincidence">Getting a summary of seroincidence<a class="anchor" aria-label="anchor" href="#getting-a-summary-of-seroincidence"></a>
</h3>
<p>Output of the calculator should be passed in to function
<code>summary</code> calculating output results:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">seroincidenceData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Seroincidence estimated given the following setup:</span></span>
<span><span class="co">## a) Antibodies   : IgG, IgM, IgA </span></span>
<span><span class="co">## b) Strata       : AgeCat </span></span>
<span><span class="co">## c) Censor limits: IgG = 0.1, IgM = 0.1, IgA = 0.1 </span></span>
<span><span class="co">## d) Quantiles    : 0.025, 0.975 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Seroincidence estimates:</span></span>
<span><span class="co">##    Lambda.est Lambda.lwr Lambda.upr  Deviance Convergence Stratum</span></span>
<span><span class="co">## 1  0.09721890 0.06397004 0.14774909 105.29815           0       1</span></span>
<span><span class="co">## 2  0.05497303 0.03573489 0.08456817 181.90627           0       2</span></span>
<span><span class="co">## 3  0.04456096 0.02845903 0.06977327 199.99357           0       3</span></span>
<span><span class="co">## 4  0.02944038 0.01715302 0.05052964 141.32558           0       4</span></span>
<span><span class="co">## 5  0.02569781 0.01436524 0.04597053 123.33213           0       5</span></span>
<span><span class="co">## 6  0.02565297 0.01587275 0.04145941 187.41060           0       6</span></span>
<span><span class="co">## 7  0.03458616 0.02012722 0.05943207 128.84486           0       7</span></span>
<span><span class="co">## 8  0.02776873 0.02640621 0.02920154 133.57166          52       8</span></span>
<span><span class="co">## 9  0.04016261 0.02133209 0.07561541  94.99389           0       9</span></span>
<span><span class="co">## 10 0.01996477 0.01898409 0.02099612 104.30992          52      10</span></span>
<span><span class="co">## 11 0.03356017 0.01917771 0.05872886 141.20168           0      11</span></span>
<span><span class="co">## 12 0.05287648 0.03263923 0.08566140 181.68655           0      12</span></span>
<span><span class="co">## 13 0.05081097 0.02946963 0.08760729 123.66670          52      13</span></span>
<span><span class="co">## 14 0.04813104 0.02945312 0.07865371 186.92218           0      14</span></span>
<span><span class="co">## 15 0.03421042 0.02210895 0.05293569 215.78684           0      15</span></span></code></pre>
<p>The <code>summary</code> function returns a list of objects as well.
It contains sub-objects <code>Antibodies</code>, <code>Strata</code>,
<code>CensorLimits</code>, <code>Quantiles</code> and
<code>Results</code>.</p>
<p>The most important sub-object of the output of the
<code>summary</code> functions is <code>Results</code>, containing
estimates of <code>Lambda</code> (annual incidence) together with their
lower and upper bounds (<code>Lambda.lwr</code> and
<code>Lambda.upr</code>, respectively). The default lower bound is 2.5%
and the upper bound is 97.5% of the distribution of <code>Lambda</code>.
These values can be changed (see <a href="#other-examples">Other
examples</a>).</p>
<p>Optionally, the summary function returns also <code>Deviance</code>
(negative log likelihood at the estimated <code>Lambda</code>) and
<code>Convergence</code> (indicator returned by function
<code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim</a></code>; value of 0 indicates convergence).</p>
<p>It may be beneficial to assign output of this function to a variable
for further analysis:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute seroincidence summary and assign to object "seroincidenceSummary".</span></span>
<span><span class="va">seroincidenceSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">seroincidenceData</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the results.</span></span>
<span><span class="va">seroincidenceSummary</span><span class="op">$</span><span class="va">Results</span></span></code></pre></div>
<pre><code><span><span class="co">##    Lambda.est Lambda.lwr Lambda.upr  Deviance Convergence Stratum</span></span>
<span><span class="co">## 1  0.09721890 0.06397004 0.14774909 105.29815           0       1</span></span>
<span><span class="co">## 2  0.05497303 0.03573489 0.08456817 181.90627           0       2</span></span>
<span><span class="co">## 3  0.04456096 0.02845903 0.06977327 199.99357           0       3</span></span>
<span><span class="co">## 4  0.02944038 0.01715302 0.05052964 141.32558           0       4</span></span>
<span><span class="co">## 5  0.02569781 0.01436524 0.04597053 123.33213           0       5</span></span>
<span><span class="co">## 6  0.02565297 0.01587275 0.04145941 187.41060           0       6</span></span>
<span><span class="co">## 7  0.03458616 0.02012722 0.05943207 128.84486           0       7</span></span>
<span><span class="co">## 8  0.02776873 0.02640621 0.02920154 133.57166          52       8</span></span>
<span><span class="co">## 9  0.04016261 0.02133209 0.07561541  94.99389           0       9</span></span>
<span><span class="co">## 10 0.01996477 0.01898409 0.02099612 104.30992          52      10</span></span>
<span><span class="co">## 11 0.03356017 0.01917771 0.05872886 141.20168           0      11</span></span>
<span><span class="co">## 12 0.05287648 0.03263923 0.08566140 181.68655           0      12</span></span>
<span><span class="co">## 13 0.05081097 0.02946963 0.08760729 123.66670          52      13</span></span>
<span><span class="co">## 14 0.04813104 0.02945312 0.07865371 186.92218           0      14</span></span>
<span><span class="co">## 15 0.03421042 0.02210895 0.05293569 215.78684           0      15</span></span></code></pre>
<p>As one may note it is a dataframe with six columns that can be later
post-processed with custom calculations.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-examples">Other examples<a class="anchor" aria-label="anchor" href="#other-examples"></a>
</h2>
<p>The following examples show the standard procedure for estimating
seroincidence.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Define cross-sectional data.</span></span>
<span><span class="va">serologyData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">campylobacterSimMediumData</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>                       IgG <span class="op">=</span> <span class="va">IgG.ratio.new</span>,</span>
<span>                       IgM <span class="op">=</span> <span class="va">IgM.ratio.new</span>,</span>
<span>                       IgA <span class="op">=</span> <span class="va">IgA.ratio.new</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define longitudinal response data</span></span>
<span><span class="va">responseParams</span> <span class="op">&lt;-</span> <span class="va">campylobacterDelftParams3</span></span>
<span></span>
<span><span class="co"># 3. Define cut-offs</span></span>
<span><span class="va">cutOffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>IgG <span class="op">=</span> <span class="fl">0.25</span>, IgM <span class="op">=</span> <span class="fl">0.25</span>, IgA <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Baseline distributions</span></span>
<span><span class="va">baseLine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>IgG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 IgM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.005</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 IgA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.005</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4a. Calculate a single seroincidence rate for all serum samples...</span></span>
<span><span class="va">seroincidenceData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est.incidence.by.html">est.incidence.by</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">serologyData</span>,</span>
<span>  antibodies <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IgG"</span>, <span class="st">"IgM"</span>, <span class="st">"IgA"</span><span class="op">)</span>,</span>
<span>  strata <span class="op">=</span> <span class="st">""</span>,</span>
<span>  params <span class="op">=</span> <span class="va">responseParams</span>,</span>
<span>  censorLimits <span class="op">=</span> <span class="va">cutOffs</span>,</span>
<span>  par0 <span class="op">=</span> <span class="va">baseLine</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4b. ...or calculate a single seroincidence rate for a single serum sample </span></span>
<span><span class="co"># (triplet of titres)...</span></span>
<span><span class="va">seroincidenceData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est.incidence.by.html">est.incidence.by</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">serologyData</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,</span>
<span>  antibodies <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IgG"</span>, <span class="st">"IgM"</span>, <span class="st">"IgA"</span><span class="op">)</span>,</span>
<span>  strata <span class="op">=</span> <span class="st">""</span>,</span>
<span>  params <span class="op">=</span> <span class="va">responseParams</span>,</span>
<span>  censorLimits <span class="op">=</span> <span class="va">cutOffs</span>,</span>
<span>  par0 <span class="op">=</span> <span class="va">baseLine</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4c. ...or calculate a single seroincidence rate for all serum samples (only IgG)</span></span>
<span><span class="va">seroincidenceData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est.incidence.by.html">est.incidence.by</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">serologyData</span>,</span>
<span>  antibodies <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IgG"</span><span class="op">)</span>,</span>
<span>  strata <span class="op">=</span> <span class="st">""</span>,</span>
<span>  params <span class="op">=</span> <span class="va">responseParams</span>,</span>
<span>  censorLimits <span class="op">=</span> <span class="va">cutOffs</span>,</span>
<span>  par0 <span class="op">=</span> <span class="va">baseLine</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5a. Produce summary of the results with 2.5% and 97.5% bounds...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">seroincidenceData</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5b. ...or produce summary of the results with 5% and 95% bounds, do not show </span></span>
<span><span class="co"># convergence...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">seroincidenceData</span>, quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, showConvergence <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5c. ...or produce summary and assign to an object...</span></span>
<span><span class="va">seroincidenceSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">seroincidenceData</span><span class="op">)</span></span>
<span><span class="co"># ...and work with the results object from now on (here: display the results).</span></span>
<span><span class="va">seroincidenceSummary</span><span class="op">$</span><span class="va">Results</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-de_Graaf_2014" class="csl-entry">
Graaf, W. F. de, M. E. E. Kretzschmar, P. F. M. Teunis, and O. Diekmann.
2014. <span>“A Two-Phase Within-Host Model for Immune Response and Its
Application to Serological Profiles of Pertussis.”</span>
<em>Epidemics</em> 9 (December): 1–7. <a href="https://doi.org/10.1016/j.epidem.2014.08.002" class="external-link">https://doi.org/10.1016/j.epidem.2014.08.002</a>.
</div>
<div id="ref-Simonsen_2009" class="csl-entry">
Simonsen, J., K. Mølbak, G. Falkenhorst, K. A. Krogfelt, A. Linneberg,
and P. F. M. Teunis. 2009. <span>“Estimation of Incidences of Infectious
Diseases Based on Antibody Measurements.”</span> <em>Statistics in
Medicine</em> 28 (14): 1882–95. <a href="https://doi.org/10.1002/sim.3592" class="external-link">https://doi.org/10.1002/sim.3592</a>.
</div>
<div id="ref-Strid_2001" class="csl-entry">
Strid, Mette Aagaard, Jørgen Engberg, Lena Brandt Larsen, Kamilla
Begtrup, Kåre Mølbak, and Karen Angeliki Krogfelt. 2001. <span>“Antibody
Responses to Campylobacter Infections Determined by an Enzyme-Linked
Immunosorbent Assay: 2-Year Follow-up Study of 210 Patients.”</span>
<em>Clinical Diagnostic Laboratory Immunology</em> 8 (2): 314–19. <a href="https://doi.org/10.1128/cdli.8.2.314-319.2001" class="external-link">https://doi.org/10.1128/cdli.8.2.314-319.2001</a>.
</div>
<div id="ref-Teunis_2016" class="csl-entry">
Teunis, P. F. M., J. C. H. van Eijkeren, W. F. de Graaf, A. Bonačić
Marinović, and M. E. E. Kretzschmar. 2016. <span>“Linking the
Seroresponse to Infection to Within-Host Heterogeneity in Antibody
Production.”</span> <em>Epidemics</em> 16 (September): 33–39. <a href="https://doi.org/10.1016/j.epidem.2016.04.001" class="external-link">https://doi.org/10.1016/j.epidem.2016.04.001</a>.
</div>
<div id="ref-Teunis_2012" class="csl-entry">
Teunis, PFM, JCH van Eijkeren, CW Ang, YTHP van Duynhoven, JB Simonsen,
MA Strid, and W van Pelt. 2012. <span>“Biomarker Dynamics: Estimating
Infection Rates from Serological Data.”</span> <em>Statistics in
Medicine</em> 31 (20): 2240–48. <a href="https://doi.org/10.1002/sim.5322" class="external-link">https://doi.org/10.1002/sim.5322</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Peter Teunis, Kristina Lai, Kristen Aiemjoy, Douglas Ezra Morrison.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
