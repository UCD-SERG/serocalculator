% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_icc.R
\name{compute_icc}
\alias{compute_icc}
\title{Calculate Intraclass Correlation Coefficient (ICC) for seroincidence}
\usage{
compute_icc(fit)
}
\arguments{
\item{fit}{a \code{seroincidence} object from \code{\link[=est_seroincidence]{est_seroincidence()}} or a
\code{seroincidence.by} object from \code{\link[=est_seroincidence_by]{est_seroincidence_by()}} that was
fitted with clustering (i.e., with \code{cluster_var} specified)}
}
\value{
\itemize{
\item For \code{seroincidence} objects: A list with components \code{icc}, \code{deff},
\code{avg_cluster_size}, \code{min_cluster_size}, \code{max_cluster_size}, \code{n_clusters},
\code{cluster_var}, and \code{antigen_isos}
\item For \code{seroincidence.by} objects: A data frame with one row per stratum
containing the same information plus stratum identifiers
}
}
\description{
Computes the Intraclass Correlation Coefficient (ICC) for a seroincidence
estimate from a clustered sampling design. The ICC measures the proportion
of total variance that is due to between-cluster variation, indicating
how correlated observations within the same cluster are.

The ICC is estimated using the design effect (DEFF):
\deqn{ICC = \frac{DEFF - 1}{\bar{m} - 1}}
where DEFF is the ratio of cluster-robust to standard variance, and
\eqn{\bar{m}} is the average cluster size.
}
\examples{
\dontrun{
library(dplyr)

xs_data <- sees_pop_data_pk_100

curve <-
  typhoid_curves_nostrat_100 |>
  filter(antigen_iso \%in\% c("HlyE_IgA", "HlyE_IgG"))

noise <- example_noise_params_pk

# Fit model with clustering
est_cluster <- est_seroincidence(
  pop_data = xs_data,
  sr_params = curve,
  noise_params = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
  cluster_var = "cluster"
)

# Calculate ICC
icc_result <- compute_icc(est_cluster)
print(icc_result$icc)

# With stratified analysis
est_by_cluster <- est_seroincidence_by(
  pop_data = xs_data,
  strata = "catchment",
  sr_params = curve,
  noise_params = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
  cluster_var = "cluster"
)

# Calculate ICC for each stratum
icc_by_result <- compute_icc(est_by_cluster)
print(icc_by_result)
}
}
