<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Seroincidence — est.incidence.by • serocalculator</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Seroincidence — est.incidence.by"><meta name="description" content="Function to estimate seroincidences based on cross-sectional
serology data and longitudinal
response model."><meta property="og:description" content="Function to estimate seroincidences based on cross-sectional
serology data and longitudinal
response model."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">serocalculator</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">1.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/serocalculator.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/enteric_fever_example.html">Enteric Fever Seroincidence Vignette</a></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/scrubTyphus_example.html">Scrub Typhus Seroincidence Vignette</a></li>
    <li><a class="dropdown-item" href="../articles/simulate_xsectionalData.html">Generate a simulated cross-sectional sample and estimate seroincidence</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UCD-SERG/serocalculator/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate Seroincidence</h1>
      <small class="dont-index">Source: <a href="https://github.com/UCD-SERG/serocalculator/blob/340/CRAN-release/update-version/R/est.incidence.by.R" class="external-link"><code>R/est.incidence.by.R</code></a></small>
      <div class="d-none name"><code>est.incidence.by.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function to estimate seroincidences based on cross-sectional
serology data and longitudinal
response model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">est.incidence.by</span><span class="op">(</span></span>
<span>  <span class="va">pop_data</span>,</span>
<span>  <span class="va">curve_params</span>,</span>
<span>  <span class="va">noise_params</span>,</span>
<span>  <span class="va">strata</span>,</span>
<span>  curve_strata_varnames <span class="op">=</span> <span class="va">strata</span>,</span>
<span>  noise_strata_varnames <span class="op">=</span> <span class="va">strata</span>,</span>
<span>  antigen_isos <span class="op">=</span> <span class="va">pop_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">"antigen_iso"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lambda_start <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  build_graph <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  num_cores <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  print_graph <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-pop-data">pop_data<a class="anchor" aria-label="anchor" href="#arg-pop-data"></a></dt>
<dd><p>a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> with cross-sectional serology data per
antibody and age, and additional columns corresponding to
each element of the <code>strata</code> input</p></dd>


<dt id="arg-curve-params">curve_params<a class="anchor" aria-label="anchor" href="#arg-curve-params"></a></dt>
<dd><p>a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:</p><ul><li><p><code>antigen_iso</code>: a <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> vector indicating antigen-isotype
combinations</p></li>
<li><p><code>iter</code>: an <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer()</a></code> vector indicating MCMC sampling iterations</p></li>
<li><p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)</p></li>
<li><p><code>y1</code>: antibody peak level (ELISA units)</p></li>
<li><p><code>t1</code>: duration of infection</p></li>
<li><p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)</p></li>
<li><p><code>r</code>: shape factor of antibody decay</p></li>
</ul></dd>


<dt id="arg-noise-params">noise_params<a class="anchor" aria-label="anchor" href="#arg-noise-params"></a></dt>
<dd><p>a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> (or <code><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble::tibble()</a></code>)
containing the following variables,
specifying noise parameters for each antigen isotype:</p><ul><li><p><code>antigen_iso</code>: antigen isotype whose noise parameters are being specified
on each row</p></li>
<li><p><code>nu</code>: biological noise</p></li>
<li><p><code>eps</code>: measurement noise</p></li>
<li><p><code>y.low</code>: lower limit of detection for the current antigen isotype</p></li>
<li><p><code>y.high</code>: upper limit of detection for the current antigen isotype</p></li>
</ul></dd>


<dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>a <a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> vector of stratum-defining variables.
Values must be variable names in <code>pop_data</code>.</p></dd>


<dt id="arg-curve-strata-varnames">curve_strata_varnames<a class="anchor" aria-label="anchor" href="#arg-curve-strata-varnames"></a></dt>
<dd><p>A subset of <code>strata</code>.
Values must be variable names in <code>curve_params</code>. Default = "".</p></dd>


<dt id="arg-noise-strata-varnames">noise_strata_varnames<a class="anchor" aria-label="anchor" href="#arg-noise-strata-varnames"></a></dt>
<dd><p>A subset of <code>strata</code>.
Values must be variable names in <code>noise_params</code>. Default = "".</p></dd>


<dt id="arg-antigen-isos">antigen_isos<a class="anchor" aria-label="anchor" href="#arg-antigen-isos"></a></dt>
<dd><p>Character vector with one or more antibody names. Values must match <code>pop_data</code></p></dd>


<dt id="arg-lambda-start">lambda_start<a class="anchor" aria-label="anchor" href="#arg-lambda-start"></a></dt>
<dd><p>starting guess for incidence rate, in years/event.</p></dd>


<dt id="arg-build-graph">build_graph<a class="anchor" aria-label="anchor" href="#arg-build-graph"></a></dt>
<dd><p>whether to graph the log-likelihood function across a range of incidence rates (lambda values)</p></dd>


<dt id="arg-num-cores">num_cores<a class="anchor" aria-label="anchor" href="#arg-num-cores"></a></dt>
<dd><p>Number of processor cores to use for
calculations when computing by strata. If set to
more than 1 and package <span class="pkg">parallel</span> is available,
then the computations are executed in parallel. Default = 1L.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical: if TRUE, print verbose log information to console</p></dd>


<dt id="arg-print-graph">print_graph<a class="anchor" aria-label="anchor" href="#arg-print-graph"></a></dt>
<dd><p>whether to display the log-likelihood curve graph in the course of running <code><a href="est.incidence.html">est.incidence()</a></code></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="est.incidence.html">est.incidence</a></code>, <code><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">stats::nlm</a></code></p><dl><dt><code>stepmin</code></dt>
<dd><p>A positive scalar providing the minimum allowable relative step length.</p></dd>

    <dt><code>stepmax</code></dt>
<dd><p>a positive scalar which gives the maximum allowable
    scaled step length.  <code>stepmax</code> is used to prevent steps which
    would cause the optimization function to overflow, to prevent the
    algorithm from leaving the area of interest in parameter space, or to
    detect divergence in the algorithm. <code>stepmax</code> would be chosen
    small enough to prevent the first two of these occurrences, but should
    be larger than any anticipated reasonable step.</p></dd>

    <dt><code>typsize</code></dt>
<dd><p>an estimate of the size of each parameter
    at the minimum.</p></dd>

    <dt><code>fscale</code></dt>
<dd><p>an estimate of the size of <code>f</code> at the minimum.</p></dd>

    <dt><code>ndigit</code></dt>
<dd><p>the number of significant digits in the function <code>f</code>.</p></dd>

    <dt><code>gradtol</code></dt>
<dd><p>a positive scalar giving the tolerance at which the
    scaled gradient is considered close enough to zero to
    terminate the algorithm.  The scaled gradient is a
    measure of the relative change in <code>f</code> in each direction
    <code>p[i]</code> divided by the relative change in <code>p[i]</code>.</p></dd>

    <dt><code>iterlim</code></dt>
<dd><p>a positive integer specifying the maximum number of
    iterations to be performed before the program is terminated.</p></dd>

    <dt><code>check.analyticals</code></dt>
<dd><p>a logical scalar specifying whether the
    analytic gradients and Hessians, if they are supplied, should be
    checked against numerical derivatives at the initial parameter
    values. This can help detect incorrectly formulated gradients or
    Hessians.</p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>

<ul><li><p>if <code>strata</code> has meaningful inputs:
An object of class <code>"seroincidence.by"</code>; i.e., a list of
<code>"seroincidence"</code> objects from <code><a href="est.incidence.html">est.incidence()</a></code>, one for each stratum,
with some meta-data attributes.</p></li>
<li><p>if <code>strata</code> is missing, <code>NULL</code>, <code>NA</code>, or <code>""</code>:
An object of class <code>"seroincidence"</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If <code>strata</code> is left empty, a warning will be produced,
recommending that you use <code><a href="est.incidence.html">est.incidence()</a></code> for unstratified analyses,
and then the data will be passed to <code><a href="est.incidence.html">est.incidence()</a></code>.
If for some reason you want to use <code>est.incidence.by()</code>
with no strata instead of calling <code><a href="est.incidence.html">est.incidence()</a></code>,
you may use <code>NA</code>, <code>NULL</code>, or <code>""</code> as the <code>strata</code>
argument to avoid that warning.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xs_data</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">sees_pop_data_pk_100</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">curve</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">typhoid_curves_nostrat_100</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">antigen_iso</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HlyE_IgA"</span>, <span class="st">"HlyE_IgG"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">noise</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">example_noise_params_pk</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est2</span> <span class="op">&lt;-</span> <span class="fu">est.incidence.by</span><span class="op">(</span></span></span>
<span class="r-in"><span>  strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catchment"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  pop_data <span class="op">=</span> <span class="va">xs_data</span>,</span></span>
<span class="r-in"><span>  curve_params <span class="op">=</span> <span class="va">curve</span>,</span></span>
<span class="r-in"><span>  noise_params <span class="op">=</span> <span class="va">noise</span>,</span></span>
<span class="r-in"><span>  antigen_isos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HlyE_IgG"</span>, <span class="st">"HlyE_IgA"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="co"># num_cores = 8 # Allow for parallel processing to decrease run time</span></span></span>
<span class="r-in"><span>  iterlim <span class="op">=</span> <span class="fl">5</span> <span class="co"># limit iterations for the purpose of this example</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>curve_params is missing all strata variables, and will be used unstratified.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> To avoid this warning, specify the desired set of stratifying variables in the `curve_strata_varnames` and `noise_strata_varnames` arguments to `est.incidence.by()`.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>noise_params is missing all strata variables, and will be used unstratified.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> To avoid this warning, specify the desired set of stratifying variables in the `curve_strata_varnames` and `noise_strata_varnames` arguments to `est.incidence.by()`.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Seroincidence estimated given the following setup:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a) Antigen isotypes   : HlyE_IgG, HlyE_IgA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b) Strata       : catchment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Seroincidence estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 13</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Stratum catchment     n est.start incidence.rate     SE CI.lwr CI.upr coverage</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> Stratu… aku          53       0.1          0.140 0.021<span style="text-decoration: underline;">6</span>  0.104  0.189     0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> Stratu… kgh          47       0.1          0.200 0.030<span style="text-decoration: underline;">1</span>  0.149  0.268     0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 4 more variables: log.lik &lt;dbl&gt;, iterations &lt;int&gt;, antigen.isos &lt;chr&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   nlm.convergence.code &lt;ord&gt;</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Peter Teunis, Kristina Lai, Chris Orwa, Kristen Aiemjoy, Douglas Ezra Morrison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

